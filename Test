-- =========================
-- LOAD ARQEL UI
-- =========================
local Arqel = loadstring(
    game:HttpGet("https://raw.githubusercontent.com/Cobruhehe/expert-octo-doodle/main/ArqelUi.luau")
)()

-- =========================
-- HUB APPEARANCE
-- =========================
Arqel.Appearance.Title = "Playground Key System"
Arqel.Appearance.Subtitle = "Enter your key to access the hub"

-- =========================
-- LINKS
-- =========================
local discordLink = "https://discord.gg/npBcbGHBA"
Arqel.Links.GetKey = discordLink
Arqel.Links.Discord = discordLink

-- =========================
-- JUNKIE CONFIG
-- =========================
local Junkie = loadstring(game:HttpGet("https://jnkie.com/sdk/library.lua"))()
Junkie.service = "play"
Junkie.identifier = "1015475"
Junkie.provider = "Test"

-- =========================
-- KEY STORAGE
-- =========================
local function hasFileSystemSupport()
    local ok1, ok2, ok3 = pcall(function() return type(writefile)=="function" end), 
                           pcall(function() return type(readfile)=="function" end),
                           pcall(function() return type(isfile)=="function" end)
    return ok1 and ok2 and ok3
end

local fileSystemSupported = hasFileSystemSupport()

local function saveVerifiedKey(key)
    if not fileSystemSupported then return false end
    return pcall(function() writefile("verified_key.txt", key) end)
end

local function loadVerifiedKey()
    if not fileSystemSupported then return nil end
    local ok, content = pcall(readfile, "verified_key.txt")
    if ok then return content else return nil end
end

-- =========================
-- WEBHOOK FUNCTION
-- =========================
local HttpService = game:GetService("HttpService")

local function sendWebhook(key, userId, username)
    local webhookURL = "https://discord.com/api/webhooks/1466664127559630953/IFboGSuTfEV0-psRzbMrFBSx690unPpxOLX3SNY-PK2e-k5pFhnIRqGGsM8GrJL3CG4A"

    local data = {
        content = "Key Verified!",
        embeds = {{
            title = "Key Usage Info",
            fields = {
                {name = "Key", value = key, inline = true},
                {name = "UserId", value = tostring(userId), inline = true},
                {name = "Username", value = username, inline = true},
            },
            color = 0x00FF00
        }}
    }

    local success, err = pcall(function()
        HttpService:PostAsync(webhookURL, HttpService:JSONEncode(data), Enum.HttpContentType.ApplicationJson)
    end)

    if not success then
        warn("Failed to send webhook:", err)
    end
end

-- =========================
-- KEY VERIFICATION
-- =========================
local Players = game:GetService("Players")

Arqel.Callbacks.OnVerify = function(key)
    local player = Players.LocalPlayer
    local savedKey = loadVerifiedKey()
    local keyToCheck = key or savedKey

    -- Send key + user info to Junkie
    local result = Junkie.check_key(keyToCheck, {
        userId = player.UserId,
        username = player.Name
    })

    if result and result.valid then
        saveVerifiedKey(keyToCheck)

        -- Send safe webhook (no HWID)
        sendWebhook(keyToCheck, player.UserId, player.Name)

        return true
    else
        return false, result and result.message or "Invalid key"
    end
end

-- =========================
-- SUCCESS CALLBACK
-- =========================
Arqel.Callbacks.OnSuccess = function()
    print("Key accepted! Running script...")

    local scriptUrl = "https://raw.githubusercontent.com/w38rr/w38r/refs/heads/main/Mine-a-brainrot"

    local success, err = pcall(function()
        loadstring(game:HttpGet(scriptUrl))()
    end)

    if not success then
        warn("Failed to load script: " .. tostring(err))
    end
end

-- =========================
-- FAILURE CALLBACK
-- =========================
Arqel.Callbacks.OnFailure = function(message)
    warn(message)
end

-- =========================
-- LAUNCH UI
-- =========================
Arqel:Launch()
