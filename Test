-- =========================
-- LOAD ARQEL UI
-- =========================
local Arqel = loadstring(
    game:HttpGet("https://raw.githubusercontent.com/Cobruhehe/expert-octo-doodle/main/ArqelUi.luau")
)()

-- =========================
-- HUB APPEARANCE
-- =========================
Arqel.Appearance.Title = "Playground Key System"
Arqel.Appearance.Subtitle = "Enter your key to access the hub"

-- =========================
-- LINKS
-- =========================
local discordLink = "https://discord.gg/npBcbGHBA"
Arqel.Links.GetKey = discordLink
Arqel.Links.Discord = discordLink

-- =========================
-- JUNKIE CONFIG
-- =========================
local Junkie = loadstring(game:HttpGet("https://jnkie.com/sdk/library.lua"))()
Junkie.service = "play"
Junkie.identifier = "1015475"
Junkie.provider = "Test"

-- =========================
-- KEY STORAGE
-- =========================
local function hasFileSystemSupport()
    return writefile and readfile and isfile
end

local fsSupported = hasFileSystemSupport()

local function saveKey(key)
    if fsSupported then
        pcall(function()
            writefile("verified_key.txt", key)
        end)
    end
end

local function loadKey()
    if fsSupported and isfile("verified_key.txt") then
        local ok, data = pcall(readfile, "verified_key.txt")
        if ok then return data end
    end
    return nil
end

-- =========================
-- KEY VERIFICATION
-- =========================
local Players = game:GetService("Players")

Arqel.Callbacks.OnVerify = function(key)
    local player = Players.LocalPlayer
    local savedKey = loadKey()
    local keyToCheck = key or savedKey

    print("[KeySystem] Verifying:", keyToCheck)
    print("[KeySystem] Player:", player.Name, player.UserId)

    -- Metadata sent to Junkie webhook
    local result = Junkie.check_key(keyToCheck, {
        userId = player.UserId,
        username = player.Name
    })

    if result and result.valid then
        saveKey(keyToCheck)
        print("[KeySystem] Key valid")
        return true
    else
        warn("[KeySystem] Key invalid")
        return false, result and result.message or "Invalid key"
    end
end

-- =========================
-- SUCCESS CALLBACK
-- =========================
Arqel.Callbacks.OnSuccess = function()
    print("[KeySystem] Access granted, loading script...")

    local scriptUrl = "https://raw.githubusercontent.com/w38rr/w38r/refs/heads/main/Mine-a-brainrot"
    local success, err = pcall(function()
        loadstring(game:HttpGet(scriptUrl))()
    end)

    if not success then
        warn("Failed to load main script:", err)
    end
end

-- =========================
-- FAILURE CALLBACK
-- =========================
Arqel.Callbacks.OnFailure = function(msg)
    warn("[KeySystem]", msg)
end

-- =========================
-- LAUNCH UI
-- =========================
Arqel:Launch()
